version: '3.8'

services:
  grobid:
    image: grobid/grobid:0.8.1
    container_name: grobid
    restart: unless-stopped
    ports:
      - "8070:8070"
    volumes:
      # Config personnalisee optimisee pour 32 coeurs
      - ./config/grobid.yaml:/opt/grobid/grobid-home/config/grobid.yaml:ro
      # Repertoire de donnees partage via NFS depuis soma
      - /mnt/sandbox/grobid-share:/opt/grobid/grobid-home/data
    environment:
      - JAVA_OPTS=-Xms4g -Xmx48g -XX:+UseG1GC -XX:ParallelGCThreads=16 -XX:ConcGCThreads=8 -XX:+UseStringDeduplication
    labels:
      - "onyx.skill=grobid-onyx-infra"
      - "onyx.service=grobid"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8070/api/isalive"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 120s
